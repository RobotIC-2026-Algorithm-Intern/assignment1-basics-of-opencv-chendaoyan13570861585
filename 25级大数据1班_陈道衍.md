# 25çº§å¤§æ•°æ®1ç­ é™ˆé“è¡ - ç¬¬ä¸€æ¬¡ä½œä¸š  

> ç‰¹åˆ«é¸£è°¢ **ChatGPT 5**ï¼Œæ²¡æœ‰å®ƒçš„å¸®åŠ©æˆ‘ç°åœ¨è¿˜åœ¨æ–°å»ºæ–‡ä»¶å¤¹ã€‚  

~~ä¸»æ’­ç¬¬ä¸€æ¬¡ç”¨ Markdownï¼Œè¿™æ³¢è¯­æ³•åº“å…è´¹~~  

---

## 1. ä»£ç æ€è·¯  

### 1.1 `homework.py`  

>- ç°åœ¨çœ‹æ¥ï¼Œ~~å¥½åƒä¹ŸæŒºéš¾çš„~~  
>- ç”¨ `cv2.VideoCapture` æ¥è¯»å–è§†é¢‘ï¼Œç”¨ `.read()` æ¥é€å¸§è¯»å–è§†é¢‘  
>- `.read()` ä¸‹æ¥çš„æ˜¯ä¸€å¼ **å½©è‰²å›¾**ï¼Œä¸ºäº†æ–¹ä¾¿å›¾åƒè¯†åˆ«ï¼Œéœ€è¦æŠŠå®ƒè½¬æ¢æˆ **HSV** å½¢å¼  

```python
hsv = cv2.cvtColor(roi, cv2.COLOR_BGR2HSV_FULL)  # roiæ˜¯ä½ ä»frameæˆªçš„åŒºåŸŸ
```

~~å‘ç°æœ‰ç‚¹è€—æ—¶é—´ï¼Œæ°´äº¿ç‚¹~~


æŠŠæ¯ä¸€å¸§è½¬æ¢æˆ HSVï¼Œå†æ ¹æ®è®¾å®šåšæ©ç ï¼Œç®€å•é™å™ªä¸€ä¸‹ï¼Œç”¨ `cv2.countNonZero()` æ¥ç»Ÿè®¡ç›®æ ‡é¢œè‰²çš„åƒç´ æ•°é‡ï¼Œå–æœ€å¤§å€¼å¹¶åˆ¤æ–­æ˜¯å¦å¤§äºé˜ˆå€¼ï¼Œæœ€ç»ˆå†³å®šçƒçš„é¢œè‰²ã€‚  

---

### 1.2 `homework_class.py`  

>- ç”¨ Class è®©ä»£ç æ•´ä½“æ›´æœ‰ç»“æ„ï¼Œå¯è¯»æ€§æ›´é«˜  
>- åœ¨ `BallDetector` ä¸­å£°æ˜ `ColorRange` ç±»ï¼Œèƒ½çœä¸å°‘äº‹æƒ…  
>- æ–¹æ³•ã€æˆå‘˜ä¹‹é—´çš„è°ƒç”¨æœ€å®¹æ˜“ææ™•ï¼Œ**å°¤å…¶æ˜¯å®ä¾‹çš„ç±»åˆ«ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€å…ƒç»„ï¼‰æ··æ·†ä¸æ¸…**  
>- å¤šçœ‹ `def` çš„è¾“å…¥è¾“å‡ºï¼Œææ¸…æ¥šè°ƒç”¨å…³ç³»ï¼Œå°±å·®ä¸å¤šäº†  

---

### 1.3 `homework_json.py`  

>- ç”¨ json åš main() é‡Œçš„åˆå§‹åŒ–ï¼ŒæŠŠç¡¬ç¼–ç çš„å‚æ•°æå–å‡ºå»  
>- **æ³¨æ„ï¼šjson ä¸­æ²¡æœ‰ tupleï¼Œè¦åœ¨ Python é‡Œè½¬å› tuple**  

---

## 2. æ ¸å¿ƒä»£ç   

ä¸‰ä»½åŸºæœ¬ä¸€æ ·ï¼Œæˆ‘å°±æ”¾æœ€æŠ˜ç£¨äººçš„é‚£ä¸ªï¼ˆ`BallDetector.run`ï¼‰ï¼š

```python
def run(self, ranges_dict, color_names,
        KERNEL=None, MIN_PIX=300, NO_BALL=0.01,
        COLOR_TEXT=None, rotate180=False):

    if COLOR_TEXT is None:
        COLOR_TEXT = {"null": (200, 200, 200)}

    while True:
        ret, frame = self.cap.read()
        if not ret:
            break
        if rotate180:
            frame = cv2.rotate(frame, cv2.ROTATE_180)

        cr = ColorRange(frame)
        cr.ranges = ranges_dict  # æ³¨å…¥é¢œè‰²èŒƒå›´

        dic = {}
        for name in color_names:
            mask = cr.make_mask(name, KERNEL)
            if mask is None:
                continue
            frame_roi, mask_roi = self._apply_roi(frame, mask)
            dic[name] = cv2.countNonZero(mask_roi)

        # é»˜è®¤æ— çƒ
        label = "null"
        if dic:
            roi_area = frame_roi.shape[0] * frame_roi.shape[1]  # é•¿Ã—å®½
            # ç­›é€‰ç¬¦åˆé˜ˆå€¼çš„é¢œè‰²
            check = {k:v for k,v in dic.items()
                     if v >= MIN_PIX and v/roi_area >= NO_BALL}
            if check:
                label = max(dic, key=dic.get)

        # ç»˜åˆ¶ç»“æœ
        if self.roi:
            x, y, w, h = self.roi
            cv2.rectangle(frame, (x,y), (x+w,y+h), (0,255,0), 2)
        cv2.putText(frame, label, (20,40),
                    cv2.FONT_HERSHEY_SIMPLEX, 1,
                    COLOR_TEXT.get(label, (0,255,0)), 2)

        cv2.imshow("Frame", frame)
        if cv2.waitKey(25) & 0xFF == 27:  # ESCé€€å‡º
            break

    self.cap.release()
    cv2.destroyAllWindows()
```

---

![æˆ‘çš„è‰¾è‰ä¸ğŸ˜­](homework/image-20240117142600734.png "my love")  
å¤§å“­ :sob:
